/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/generate/prompt/route";
exports.ids = ["app/api/generate/prompt/route"];
exports.modules = {

/***/ "(rsc)/./app/api/generate/prompt/route.ts":
/*!******************************************!*\
  !*** ./app/api/generate/prompt/route.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var everart__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! everart */ \"(rsc)/./node_modules/everart/dist/index.js\");\n/* harmony import */ var everart__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(everart__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _lib_db_astra__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/db/astra */ \"(rsc)/./app/lib/db/astra.ts\");\n\n\n\n// Initialize EverArt client\nconst everartApiKey = process.env.EVERART_API_KEY;\nif (!everartApiKey) {\n    throw new Error('EVERART_API_KEY environment variable is required');\n}\nconst everart = new (everart__WEBPACK_IMPORTED_MODULE_1___default())(everartApiKey);\n// Style prefix for consistent image generation\n// const PROMPT_PREFIX = \"Create a cute, retro-style creature in authentic low-resolution pixel art, \" +\n// \"reminiscent of classic SNES RPGs. The character should have large, sparkly eyes, chunky pixel shading, \" +\n// \"and deliberately limited color palette. The overall style should embrace the constraints of 16-bit era graphics with visible, \" +\n// \"chunky pixels and that nostalgic game aesthetic.\";\nconst PROMPT_PREFIX = \"Kawaii pixel art: Adorable chimera creature, ultra low-resolutionpixel 16-bit style. \" + \"Extremely pixelated NES/SNES aesthetic, chunky dithering patterns, and high contrast. \" + \"Rainbow gradient background.\";\n// Local fallback image that doesn't depend on external services\nconst FALLBACK_IMAGE_URL = \"/images/codebeast-placeholder.png\";\n// Helper function to clean the language string\nfunction cleanLanguagesString(rawLangString) {\n    if (!rawLangString) return '';\n    // Remove prefix like \"languages:\", brackets [], and single quotes '\n    return rawLangString.replace(/^languages:\\s*\\[|\\]|'/g, '').trim();\n}\n// Helper function to clean the GitHub URL\nfunction cleanGithubUrl(rawUrl, username) {\n    const fallbackUrl = `https://github.com/${username.toLowerCase()}`;\n    if (!rawUrl) {\n        console.warn(`cleanGithubUrl: Raw URL missing. Returning fallback: ${fallbackUrl}`);\n        return fallbackUrl;\n    }\n    const githubPrefix = 'https://github.com/';\n    const index = rawUrl.indexOf(githubPrefix);\n    if (index !== -1) {\n        const extractedUrl = rawUrl.substring(index);\n        console.log(`cleanGithubUrl: Extracted \"${extractedUrl}\" from \"${rawUrl}\"`);\n        return extractedUrl;\n    }\n    console.warn(`cleanGithubUrl: Unexpected format for rawUrl: \"${rawUrl}\". Returning fallback: ${fallbackUrl}`);\n    return fallbackUrl;\n}\nasync function POST(request) {\n    try {\n        const body = await request.json();\n        console.log(\"API Route: Received request body:\", body);\n        const { username } = body;\n        const normalizedUsername = username.toLowerCase(); // Ensure we use normalized consistently\n        if (!username) {\n            console.error(\"Username is missing from request body\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Username is required\"\n            }, {\n                status: 400\n            });\n        }\n        // First, check if we have existing user details\n        const existingDetails = await (0,_lib_db_astra__WEBPACK_IMPORTED_MODULE_2__.getUserDetails)(username);\n        if (existingDetails) {\n            console.log(\"API Route: Using existing user details from DB\");\n            // Clean languages from DB details\n            const cleanedLanguages = cleanLanguagesString(existingDetails.languages);\n            const cleanedGithubUrl = cleanGithubUrl(existingDetails.githubUrl, username);\n            const dataToLog = {\n                ...existingDetails,\n                languages: cleanedLanguages,\n                githubUrl: cleanedGithubUrl,\n                repoCount: existingDetails.repoCount ?? 30,\n                animalSelection: existingDetails.animalSelection // Pass actual value (could be undefined)\n            };\n            console.log(\"API Route: Data before EverArt (DB Cache):\", JSON.stringify(dataToLog, null, 2));\n            // Generate new image using existing prompt\n            try {\n                const fullPrompt = PROMPT_PREFIX + existingDetails.prompt;\n                console.log(\"Full prompt for existing user:\", fullPrompt);\n                const generations = await everart.v1.generations.create('5000', fullPrompt, 'txt2img', {\n                    imageCount: 1,\n                    height: 512,\n                    width: 512\n                });\n                if (!generations || generations.length === 0) {\n                    throw new Error('No generations returned from EverArt');\n                }\n                const result = await everart.v1.generations.fetchWithPolling(generations[0].id);\n                console.log(\"EverArt generation result (cached path):\", result);\n                const finalImageUrl = result.image_url || FALLBACK_IMAGE_URL;\n                // --- Save/Update the image record in the DB --- \n                if (result.image_url) {\n                    try {\n                        console.log(`API Route: Upserting image for ${normalizedUsername} (cached path)`);\n                        await (0,_lib_db_astra__WEBPACK_IMPORTED_MODULE_2__.upsertImage)({\n                            username: normalizedUsername,\n                            image_url: finalImageUrl,\n                            created_at: new Date().toISOString()\n                        });\n                        console.log(`API Route: Upsert successful for ${normalizedUsername}`);\n                    } catch (dbError) {\n                        console.error(`API Route: Failed to upsert image for ${normalizedUsername} (cached path):`, dbError);\n                    // Decide if failure to save should prevent returning success to user?\n                    // For now, we'll still return the image URL but log the error.\n                    }\n                }\n                // --- End Save/Update ---\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    languages: cleanedLanguages,\n                    prompt: existingDetails.prompt,\n                    githubUrl: cleanedGithubUrl,\n                    repoCount: dataToLog.repoCount,\n                    animalSelection: dataToLog.animalSelection,\n                    imageUrl: finalImageUrl,\n                    status: {\n                        langflow: \"cached\",\n                        everart: result.image_url ? \"success\" : \"error\"\n                    }\n                });\n            } catch (everartError) {\n                console.error(\"Error calling EverArt API:\", everartError);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    languages: cleanedLanguages,\n                    prompt: existingDetails.prompt,\n                    githubUrl: cleanedGithubUrl,\n                    repoCount: dataToLog.repoCount,\n                    animalSelection: dataToLog.animalSelection,\n                    imageUrl: FALLBACK_IMAGE_URL,\n                    status: {\n                        langflow: \"cached\",\n                        everart: \"error\"\n                    }\n                });\n            }\n        }\n        // Check if environment variables are set\n        if (!process.env.LANGFLOW_BASE_URL || !process.env.LANGFLOW_FLOW_ID || !process.env.EVERART_API_KEY) {\n            console.error(\"Missing required environment variables:\", {\n                LANGFLOW_BASE_URL: !!process.env.LANGFLOW_BASE_URL,\n                LANGFLOW_FLOW_ID: !!process.env.LANGFLOW_FLOW_ID,\n                EVERART_API_KEY: !!process.env.EVERART_API_KEY\n            });\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Server configuration error\"\n            }, {\n                status: 500\n            });\n        }\n        // Call Langflow API directly\n        const langflowUrl = `${process.env.LANGFLOW_BASE_URL}/api/v1/run/${process.env.LANGFLOW_FLOW_ID}`;\n        console.log(\"Calling Langflow at:\", langflowUrl);\n        try {\n            // First, return initial data without image\n            const response = await fetch(langflowUrl, {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({\n                    input: {\n                        text: normalizedUsername // Use normalized username\n                    }\n                })\n            });\n            if (!response.ok) {\n                const errorText = await response.text();\n                console.error(\"Langflow API error:\", {\n                    status: response.status,\n                    statusText: response.statusText,\n                    error: errorText,\n                    url: langflowUrl\n                });\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: `Failed to generate prompt: ${response.status} ${response.statusText}`\n                }, {\n                    status: response.status\n                });\n            }\n            const langflowResponseData = await response.json();\n            console.log(\"API Route: Full Langflow response:\", JSON.stringify(langflowResponseData, null, 2));\n            // Extract the message from the Langflow response structure\n            let rawMessage;\n            if (langflowResponseData?.outputs?.[0]?.outputs?.[0]?.messages?.[0]?.message) {\n                rawMessage = langflowResponseData.outputs[0].outputs[0].messages[0].message;\n            }\n            if (!rawMessage) {\n                console.error(\"Could not find message in response. Full response:\", langflowResponseData);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Could not extract message from response\"\n                }, {\n                    status: 500\n                });\n            }\n            // Parse the pipe-delimited fields\n            const [rawLanguages, prompt, rawGithubUrl] = rawMessage.split('|').map((field)=>field.trim());\n            // Clean languages from Langflow details\n            const cleanedLanguages = cleanLanguagesString(rawLanguages);\n            const cleanedGithubUrl = cleanGithubUrl(rawGithubUrl, username);\n            // --- Log new data --- \n            const newDataToLog = {\n                languages: cleanedLanguages,\n                prompt,\n                githubUrl: cleanedGithubUrl,\n                repoCount: 30,\n                animalSelection: undefined // Explicitly undefined as Langflow doesn't provide it\n            };\n            console.log(\"API Route: Data before EverArt (Langflow):\", JSON.stringify(newDataToLog, null, 2));\n            // --- End Log ---\n            // Generate image using EverArt SDK\n            try {\n                const fullPrompt = PROMPT_PREFIX + prompt;\n                console.log(\"Full prompt for new user:\", fullPrompt);\n                const generations = await everart.v1.generations.create('5000', fullPrompt, 'txt2img', {\n                    imageCount: 1,\n                    height: 512,\n                    width: 512\n                });\n                if (!generations || generations.length === 0) {\n                    throw new Error('No generations returned from EverArt');\n                }\n                // Wait for the first generation to complete\n                const result = await everart.v1.generations.fetchWithPolling(generations[0].id);\n                console.log(\"EverArt generation result (new path):\", result);\n                const finalImageUrl = result.image_url || FALLBACK_IMAGE_URL;\n                // --- Save/Update the image record in the DB --- \n                if (result.image_url) {\n                    try {\n                        console.log(`API Route: Upserting image for ${normalizedUsername} (new path)`);\n                        await (0,_lib_db_astra__WEBPACK_IMPORTED_MODULE_2__.upsertImage)({\n                            username: normalizedUsername,\n                            image_url: finalImageUrl,\n                            created_at: new Date().toISOString()\n                        });\n                        console.log(`API Route: Upsert successful for ${normalizedUsername}`);\n                    } catch (dbError) {\n                        console.error(`API Route: Failed to upsert image for ${normalizedUsername} (new path):`, dbError);\n                    // Log error but continue\n                    }\n                }\n                // --- End Save/Update ---\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    languages: cleanedLanguages,\n                    prompt,\n                    githubUrl: cleanedGithubUrl,\n                    repoCount: newDataToLog.repoCount,\n                    animalSelection: newDataToLog.animalSelection,\n                    imageUrl: finalImageUrl,\n                    username: normalizedUsername,\n                    status: {\n                        langflow: \"success\",\n                        everart: result.image_url ? \"success\" : \"error\"\n                    }\n                });\n            } catch (everartError) {\n                console.error(\"Error calling EverArt API:\", everartError);\n                // Continue with a placeholder image if EverArt fails\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    languages: cleanedLanguages,\n                    prompt,\n                    githubUrl: cleanedGithubUrl,\n                    repoCount: newDataToLog.repoCount,\n                    animalSelection: newDataToLog.animalSelection,\n                    imageUrl: FALLBACK_IMAGE_URL,\n                    username: normalizedUsername,\n                    status: {\n                        langflow: \"success\",\n                        everart: \"error\"\n                    }\n                });\n            }\n        } catch (langflowError) {\n            console.error(\"Error calling Langflow API:\", langflowError);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to communicate with Langflow API\",\n                username: normalizedUsername,\n                status: {\n                    langflow: \"error\",\n                    everart: \"not_started\"\n                }\n            }, {\n                status: 500\n            });\n        }\n    } catch (error) {\n        console.error(\"Error in API route:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Failed to generate prompt\",\n            status: {\n                langflow: \"error\",\n                everart: \"not_started\"\n            }\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkFDRjtZQUNGO1FBQ0YsRUFBRSxPQUFPbUYsZUFBZTtZQUN0QnZFLFFBQVFhLEtBQUssQ0FBQywrQkFBK0IwRDtZQUM3QyxPQUFPNUYscURBQVlBLENBQUNnQyxJQUFJLENBQ3RCO2dCQUNFRSxPQUFPO2dCQUNQaEIsVUFBVWU7Z0JBQ1ZFLFFBQVE7b0JBQ044QixVQUFVO29CQUNWeEQsU0FBUztnQkFDWDtZQUNGLEdBQ0E7Z0JBQUUwQixRQUFRO1lBQUk7UUFFbEI7SUFDRixFQUFFLE9BQU9ELE9BQU87UUFDZGIsUUFBUWEsS0FBSyxDQUFDLHVCQUF1QkE7UUFDckMsT0FBT2xDLHFEQUFZQSxDQUFDZ0MsSUFBSSxDQUN0QjtZQUNFRSxPQUFPO1lBQ1BDLFFBQVE7Z0JBQ044QixVQUFVO2dCQUNWeEQsU0FBUztZQUNYO1FBQ0YsR0FDQTtZQUFFMEIsUUFBUTtRQUFJO0lBRWxCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9kYXZpZC5naWxhcmRpL2NvZGViZWFzdHMvYXBwL2FwaS9nZW5lcmF0ZS9wcm9tcHQvcm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XG5pbXBvcnQgRXZlckFydCBmcm9tICdldmVyYXJ0JztcbmltcG9ydCB7IGdldFVzZXJEZXRhaWxzLCB1cHNlcnRJbWFnZSB9IGZyb20gXCIuLi8uLi8uLi9saWIvZGIvYXN0cmFcIjtcblxuLy8gRGVmaW5lIHR5cGVzIGZyb20gdGhlIEV2ZXJBcnQgU0RLXG50eXBlIEdlbmVyYXRpb24gPSB7XG4gIGlkOiBzdHJpbmc7XG4gIG1vZGVsX2lkOiBzdHJpbmc7XG4gIHN0YXR1czogJ1NUQVJUSU5HJyB8ICdQUk9DRVNTSU5HJyB8ICdTVUNDRUVERUQnIHwgJ0ZBSUxFRCcgfCAnQ0FOQ0VMRUQnO1xuICBpbWFnZV91cmw6IHN0cmluZyB8IG51bGw7XG4gIHR5cGU6ICd0eHQyaW1nJyB8ICdpbWcyaW1nJztcbiAgY3JlYXRlZEF0OiBEYXRlO1xuICB1cGRhdGVkQXQ6IERhdGU7XG59O1xuXG4vLyBJbml0aWFsaXplIEV2ZXJBcnQgY2xpZW50XG5jb25zdCBldmVyYXJ0QXBpS2V5ID0gcHJvY2Vzcy5lbnYuRVZFUkFSVF9BUElfS0VZO1xuaWYgKCFldmVyYXJ0QXBpS2V5KSB7XG4gIHRocm93IG5ldyBFcnJvcignRVZFUkFSVF9BUElfS0VZIGVudmlyb25tZW50IHZhcmlhYmxlIGlzIHJlcXVpcmVkJyk7XG59XG5jb25zdCBldmVyYXJ0ID0gbmV3IEV2ZXJBcnQoZXZlcmFydEFwaUtleSk7XG5cbi8vIFN0eWxlIHByZWZpeCBmb3IgY29uc2lzdGVudCBpbWFnZSBnZW5lcmF0aW9uXG4vLyBjb25zdCBQUk9NUFRfUFJFRklYID0gXCJDcmVhdGUgYSBjdXRlLCByZXRyby1zdHlsZSBjcmVhdHVyZSBpbiBhdXRoZW50aWMgbG93LXJlc29sdXRpb24gcGl4ZWwgYXJ0LCBcIiArXG4vLyBcInJlbWluaXNjZW50IG9mIGNsYXNzaWMgU05FUyBSUEdzLiBUaGUgY2hhcmFjdGVyIHNob3VsZCBoYXZlIGxhcmdlLCBzcGFya2x5IGV5ZXMsIGNodW5reSBwaXhlbCBzaGFkaW5nLCBcIiArXG4vLyBcImFuZCBkZWxpYmVyYXRlbHkgbGltaXRlZCBjb2xvciBwYWxldHRlLiBUaGUgb3ZlcmFsbCBzdHlsZSBzaG91bGQgZW1icmFjZSB0aGUgY29uc3RyYWludHMgb2YgMTYtYml0IGVyYSBncmFwaGljcyB3aXRoIHZpc2libGUsIFwiICtcbi8vIFwiY2h1bmt5IHBpeGVscyBhbmQgdGhhdCBub3N0YWxnaWMgZ2FtZSBhZXN0aGV0aWMuXCI7XG5cbmNvbnN0IFBST01QVF9QUkVGSVggPSBcIkthd2FpaSBwaXhlbCBhcnQ6IEFkb3JhYmxlIGNoaW1lcmEgY3JlYXR1cmUsIHVsdHJhIGxvdy1yZXNvbHV0aW9ucGl4ZWwgMTYtYml0IHN0eWxlLiBcIiArXG4gIFwiRXh0cmVtZWx5IHBpeGVsYXRlZCBORVMvU05FUyBhZXN0aGV0aWMsIGNodW5reSBkaXRoZXJpbmcgcGF0dGVybnMsIGFuZCBoaWdoIGNvbnRyYXN0LiBcIiArXG4gIFwiUmFpbmJvdyBncmFkaWVudCBiYWNrZ3JvdW5kLlwiO1xuXG4vLyBMb2NhbCBmYWxsYmFjayBpbWFnZSB0aGF0IGRvZXNuJ3QgZGVwZW5kIG9uIGV4dGVybmFsIHNlcnZpY2VzXG5jb25zdCBGQUxMQkFDS19JTUFHRV9VUkwgPSBcIi9pbWFnZXMvY29kZWJlYXN0LXBsYWNlaG9sZGVyLnBuZ1wiO1xuXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gY2xlYW4gdGhlIGxhbmd1YWdlIHN0cmluZ1xuZnVuY3Rpb24gY2xlYW5MYW5ndWFnZXNTdHJpbmcocmF3TGFuZ1N0cmluZzogc3RyaW5nIHwgdW5kZWZpbmVkKTogc3RyaW5nIHtcbiAgaWYgKCFyYXdMYW5nU3RyaW5nKSByZXR1cm4gJyc7XG4gIC8vIFJlbW92ZSBwcmVmaXggbGlrZSBcImxhbmd1YWdlczpcIiwgYnJhY2tldHMgW10sIGFuZCBzaW5nbGUgcXVvdGVzICdcbiAgcmV0dXJuIHJhd0xhbmdTdHJpbmcucmVwbGFjZSgvXmxhbmd1YWdlczpcXHMqXFxbfFxcXXwnL2csICcnKS50cmltKCk7XG59XG5cbi8vIEhlbHBlciBmdW5jdGlvbiB0byBjbGVhbiB0aGUgR2l0SHViIFVSTFxuZnVuY3Rpb24gY2xlYW5HaXRodWJVcmwocmF3VXJsOiBzdHJpbmcgfCB1bmRlZmluZWQsIHVzZXJuYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICBjb25zdCBmYWxsYmFja1VybCA9IGBodHRwczovL2dpdGh1Yi5jb20vJHt1c2VybmFtZS50b0xvd2VyQ2FzZSgpfWA7XG4gIGlmICghcmF3VXJsKSB7XG4gICAgY29uc29sZS53YXJuKGBjbGVhbkdpdGh1YlVybDogUmF3IFVSTCBtaXNzaW5nLiBSZXR1cm5pbmcgZmFsbGJhY2s6ICR7ZmFsbGJhY2tVcmx9YCk7XG4gICAgcmV0dXJuIGZhbGxiYWNrVXJsO1xuICB9IFxuICBcbiAgY29uc3QgZ2l0aHViUHJlZml4ID0gJ2h0dHBzOi8vZ2l0aHViLmNvbS8nO1xuICBjb25zdCBpbmRleCA9IHJhd1VybC5pbmRleE9mKGdpdGh1YlByZWZpeCk7XG4gIFxuICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgY29uc3QgZXh0cmFjdGVkVXJsID0gcmF3VXJsLnN1YnN0cmluZyhpbmRleCk7XG4gICAgY29uc29sZS5sb2coYGNsZWFuR2l0aHViVXJsOiBFeHRyYWN0ZWQgXCIke2V4dHJhY3RlZFVybH1cIiBmcm9tIFwiJHtyYXdVcmx9XCJgKTtcbiAgICByZXR1cm4gZXh0cmFjdGVkVXJsO1xuICB9IFxuICBcbiAgY29uc29sZS53YXJuKGBjbGVhbkdpdGh1YlVybDogVW5leHBlY3RlZCBmb3JtYXQgZm9yIHJhd1VybDogXCIke3Jhd1VybH1cIi4gUmV0dXJuaW5nIGZhbGxiYWNrOiAke2ZhbGxiYWNrVXJsfWApO1xuICByZXR1cm4gZmFsbGJhY2tVcmw7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG4gICAgY29uc29sZS5sb2coXCJBUEkgUm91dGU6IFJlY2VpdmVkIHJlcXVlc3QgYm9keTpcIiwgYm9keSk7XG4gICAgXG4gICAgY29uc3QgeyB1c2VybmFtZSB9ID0gYm9keTtcbiAgICBjb25zdCBub3JtYWxpemVkVXNlcm5hbWUgPSB1c2VybmFtZS50b0xvd2VyQ2FzZSgpOyAvLyBFbnN1cmUgd2UgdXNlIG5vcm1hbGl6ZWQgY29uc2lzdGVudGx5XG5cbiAgICBpZiAoIXVzZXJuYW1lKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiVXNlcm5hbWUgaXMgbWlzc2luZyBmcm9tIHJlcXVlc3QgYm9keVwiKTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogXCJVc2VybmFtZSBpcyByZXF1aXJlZFwiIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBGaXJzdCwgY2hlY2sgaWYgd2UgaGF2ZSBleGlzdGluZyB1c2VyIGRldGFpbHNcbiAgICBjb25zdCBleGlzdGluZ0RldGFpbHMgPSBhd2FpdCBnZXRVc2VyRGV0YWlscyh1c2VybmFtZSk7XG4gICAgaWYgKGV4aXN0aW5nRGV0YWlscykge1xuICAgICAgY29uc29sZS5sb2coXCJBUEkgUm91dGU6IFVzaW5nIGV4aXN0aW5nIHVzZXIgZGV0YWlscyBmcm9tIERCXCIpO1xuICAgICAgXG4gICAgICAvLyBDbGVhbiBsYW5ndWFnZXMgZnJvbSBEQiBkZXRhaWxzXG4gICAgICBjb25zdCBjbGVhbmVkTGFuZ3VhZ2VzID0gY2xlYW5MYW5ndWFnZXNTdHJpbmcoZXhpc3RpbmdEZXRhaWxzLmxhbmd1YWdlcyk7XG4gICAgICBjb25zdCBjbGVhbmVkR2l0aHViVXJsID0gY2xlYW5HaXRodWJVcmwoZXhpc3RpbmdEZXRhaWxzLmdpdGh1YlVybCwgdXNlcm5hbWUpO1xuICAgICAgXG4gICAgICBjb25zdCBkYXRhVG9Mb2cgPSB7XG4gICAgICAgIC4uLmV4aXN0aW5nRGV0YWlscyxcbiAgICAgICAgbGFuZ3VhZ2VzOiBjbGVhbmVkTGFuZ3VhZ2VzLFxuICAgICAgICBnaXRodWJVcmw6IGNsZWFuZWRHaXRodWJVcmwsXG4gICAgICAgIHJlcG9Db3VudDogZXhpc3RpbmdEZXRhaWxzLnJlcG9Db3VudCA/PyAzMCwgLy8gS2VlcCByZXBvQ291bnQgcGxhY2Vob2xkZXIgZm9yIG5vd1xuICAgICAgICBhbmltYWxTZWxlY3Rpb246IGV4aXN0aW5nRGV0YWlscy5hbmltYWxTZWxlY3Rpb24gLy8gUGFzcyBhY3R1YWwgdmFsdWUgKGNvdWxkIGJlIHVuZGVmaW5lZClcbiAgICAgIH07XG4gICAgICBjb25zb2xlLmxvZyhcIkFQSSBSb3V0ZTogRGF0YSBiZWZvcmUgRXZlckFydCAoREIgQ2FjaGUpOlwiLCBKU09OLnN0cmluZ2lmeShkYXRhVG9Mb2csIG51bGwsIDIpKTtcblxuICAgICAgLy8gR2VuZXJhdGUgbmV3IGltYWdlIHVzaW5nIGV4aXN0aW5nIHByb21wdFxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZnVsbFByb21wdCA9IFBST01QVF9QUkVGSVggKyBleGlzdGluZ0RldGFpbHMucHJvbXB0O1xuICAgICAgICBjb25zb2xlLmxvZyhcIkZ1bGwgcHJvbXB0IGZvciBleGlzdGluZyB1c2VyOlwiLCBmdWxsUHJvbXB0KTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGdlbmVyYXRpb25zID0gYXdhaXQgZXZlcmFydC52MS5nZW5lcmF0aW9ucy5jcmVhdGUoXG4gICAgICAgICAgJzUwMDAnLCAvLyBNb2RlbCBJRCBmb3IgRkxVWDEuMVxuICAgICAgICAgIGZ1bGxQcm9tcHQsXG4gICAgICAgICAgJ3R4dDJpbWcnLFxuICAgICAgICAgIHsgXG4gICAgICAgICAgICBpbWFnZUNvdW50OiAxLFxuICAgICAgICAgICAgaGVpZ2h0OiA1MTIsXG4gICAgICAgICAgICB3aWR0aDogNTEyXG4gICAgICAgICAgfVxuICAgICAgICApIGFzIEdlbmVyYXRpb25bXTtcblxuICAgICAgICBpZiAoIWdlbmVyYXRpb25zIHx8IGdlbmVyYXRpb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gZ2VuZXJhdGlvbnMgcmV0dXJuZWQgZnJvbSBFdmVyQXJ0Jyk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBldmVyYXJ0LnYxLmdlbmVyYXRpb25zLmZldGNoV2l0aFBvbGxpbmcoZ2VuZXJhdGlvbnNbMF0uaWQpIGFzIEdlbmVyYXRpb247XG4gICAgICAgIGNvbnNvbGUubG9nKFwiRXZlckFydCBnZW5lcmF0aW9uIHJlc3VsdCAoY2FjaGVkIHBhdGgpOlwiLCByZXN1bHQpO1xuXG4gICAgICAgIGNvbnN0IGZpbmFsSW1hZ2VVcmwgPSByZXN1bHQuaW1hZ2VfdXJsIHx8IEZBTExCQUNLX0lNQUdFX1VSTDtcblxuICAgICAgICAvLyAtLS0gU2F2ZS9VcGRhdGUgdGhlIGltYWdlIHJlY29yZCBpbiB0aGUgREIgLS0tIFxuICAgICAgICBpZiAocmVzdWx0LmltYWdlX3VybCkgeyAvLyBPbmx5IHNhdmUgaWYgRXZlckFydCBzdWNjZWVkZWRcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYEFQSSBSb3V0ZTogVXBzZXJ0aW5nIGltYWdlIGZvciAke25vcm1hbGl6ZWRVc2VybmFtZX0gKGNhY2hlZCBwYXRoKWApO1xuICAgICAgICAgICAgYXdhaXQgdXBzZXJ0SW1hZ2Uoe1xuICAgICAgICAgICAgICB1c2VybmFtZTogbm9ybWFsaXplZFVzZXJuYW1lLCBcbiAgICAgICAgICAgICAgaW1hZ2VfdXJsOiBmaW5hbEltYWdlVXJsLFxuICAgICAgICAgICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYEFQSSBSb3V0ZTogVXBzZXJ0IHN1Y2Nlc3NmdWwgZm9yICR7bm9ybWFsaXplZFVzZXJuYW1lfWApO1xuICAgICAgICAgIH0gY2F0Y2ggKGRiRXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEFQSSBSb3V0ZTogRmFpbGVkIHRvIHVwc2VydCBpbWFnZSBmb3IgJHtub3JtYWxpemVkVXNlcm5hbWV9IChjYWNoZWQgcGF0aCk6YCwgZGJFcnJvcik7XG4gICAgICAgICAgICAvLyBEZWNpZGUgaWYgZmFpbHVyZSB0byBzYXZlIHNob3VsZCBwcmV2ZW50IHJldHVybmluZyBzdWNjZXNzIHRvIHVzZXI/XG4gICAgICAgICAgICAvLyBGb3Igbm93LCB3ZSdsbCBzdGlsbCByZXR1cm4gdGhlIGltYWdlIFVSTCBidXQgbG9nIHRoZSBlcnJvci5cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gLS0tIEVuZCBTYXZlL1VwZGF0ZSAtLS1cblxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBcbiAgICAgICAgICBsYW5ndWFnZXM6IGNsZWFuZWRMYW5ndWFnZXMsXG4gICAgICAgICAgcHJvbXB0OiBleGlzdGluZ0RldGFpbHMucHJvbXB0LFxuICAgICAgICAgIGdpdGh1YlVybDogY2xlYW5lZEdpdGh1YlVybCxcbiAgICAgICAgICByZXBvQ291bnQ6IGRhdGFUb0xvZy5yZXBvQ291bnQsXG4gICAgICAgICAgYW5pbWFsU2VsZWN0aW9uOiBkYXRhVG9Mb2cuYW5pbWFsU2VsZWN0aW9uLCAvLyBTZW5kIGFjdHVhbCB2YWx1ZSAoY291bGQgYmUgdW5kZWZpbmVkKVxuICAgICAgICAgIGltYWdlVXJsOiBmaW5hbEltYWdlVXJsLFxuICAgICAgICAgIHN0YXR1czoge1xuICAgICAgICAgICAgbGFuZ2Zsb3c6IFwiY2FjaGVkXCIsXG4gICAgICAgICAgICBldmVyYXJ0OiByZXN1bHQuaW1hZ2VfdXJsID8gXCJzdWNjZXNzXCIgOiBcImVycm9yXCJcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZXZlcmFydEVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjYWxsaW5nIEV2ZXJBcnQgQVBJOlwiLCBldmVyYXJ0RXJyb3IpO1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBcbiAgICAgICAgICBsYW5ndWFnZXM6IGNsZWFuZWRMYW5ndWFnZXMsXG4gICAgICAgICAgcHJvbXB0OiBleGlzdGluZ0RldGFpbHMucHJvbXB0LFxuICAgICAgICAgIGdpdGh1YlVybDogY2xlYW5lZEdpdGh1YlVybCxcbiAgICAgICAgICByZXBvQ291bnQ6IGRhdGFUb0xvZy5yZXBvQ291bnQsXG4gICAgICAgICAgYW5pbWFsU2VsZWN0aW9uOiBkYXRhVG9Mb2cuYW5pbWFsU2VsZWN0aW9uLCAvLyBTZW5kIGFjdHVhbCB2YWx1ZSAoY291bGQgYmUgdW5kZWZpbmVkKVxuICAgICAgICAgIGltYWdlVXJsOiBGQUxMQkFDS19JTUFHRV9VUkwsXG4gICAgICAgICAgc3RhdHVzOiB7XG4gICAgICAgICAgICBsYW5nZmxvdzogXCJjYWNoZWRcIixcbiAgICAgICAgICAgIGV2ZXJhcnQ6IFwiZXJyb3JcIlxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgZW52aXJvbm1lbnQgdmFyaWFibGVzIGFyZSBzZXRcbiAgICBpZiAoIXByb2Nlc3MuZW52LkxBTkdGTE9XX0JBU0VfVVJMIHx8ICFwcm9jZXNzLmVudi5MQU5HRkxPV19GTE9XX0lEIHx8ICFwcm9jZXNzLmVudi5FVkVSQVJUX0FQSV9LRVkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJNaXNzaW5nIHJlcXVpcmVkIGVudmlyb25tZW50IHZhcmlhYmxlczpcIiwge1xuICAgICAgICBMQU5HRkxPV19CQVNFX1VSTDogISFwcm9jZXNzLmVudi5MQU5HRkxPV19CQVNFX1VSTCxcbiAgICAgICAgTEFOR0ZMT1dfRkxPV19JRDogISFwcm9jZXNzLmVudi5MQU5HRkxPV19GTE9XX0lELFxuICAgICAgICBFVkVSQVJUX0FQSV9LRVk6ICEhcHJvY2Vzcy5lbnYuRVZFUkFSVF9BUElfS0VZXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogXCJTZXJ2ZXIgY29uZmlndXJhdGlvbiBlcnJvclwiIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBDYWxsIExhbmdmbG93IEFQSSBkaXJlY3RseVxuICAgIGNvbnN0IGxhbmdmbG93VXJsID0gYCR7cHJvY2Vzcy5lbnYuTEFOR0ZMT1dfQkFTRV9VUkx9L2FwaS92MS9ydW4vJHtwcm9jZXNzLmVudi5MQU5HRkxPV19GTE9XX0lEfWA7XG4gICAgY29uc29sZS5sb2coXCJDYWxsaW5nIExhbmdmbG93IGF0OlwiLCBsYW5nZmxvd1VybCk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIEZpcnN0LCByZXR1cm4gaW5pdGlhbCBkYXRhIHdpdGhvdXQgaW1hZ2VcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2gobGFuZ2Zsb3dVcmwsIHtcbiAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgaW5wdXQ6IHtcbiAgICAgICAgICAgIHRleHQ6IG5vcm1hbGl6ZWRVc2VybmFtZSAvLyBVc2Ugbm9ybWFsaXplZCB1c2VybmFtZVxuICAgICAgICAgIH1cbiAgICAgICAgfSksXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICBjb25zdCBlcnJvclRleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJMYW5nZmxvdyBBUEkgZXJyb3I6XCIsIHtcbiAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgICBzdGF0dXNUZXh0OiByZXNwb25zZS5zdGF0dXNUZXh0LFxuICAgICAgICAgIGVycm9yOiBlcnJvclRleHQsXG4gICAgICAgICAgdXJsOiBsYW5nZmxvd1VybFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICAgIHsgZXJyb3I6IGBGYWlsZWQgdG8gZ2VuZXJhdGUgcHJvbXB0OiAke3Jlc3BvbnNlLnN0YXR1c30gJHtyZXNwb25zZS5zdGF0dXNUZXh0fWAgfSxcbiAgICAgICAgICB7IHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzIH1cbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbGFuZ2Zsb3dSZXNwb25zZURhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICBjb25zb2xlLmxvZyhcIkFQSSBSb3V0ZTogRnVsbCBMYW5nZmxvdyByZXNwb25zZTpcIiwgSlNPTi5zdHJpbmdpZnkobGFuZ2Zsb3dSZXNwb25zZURhdGEsIG51bGwsIDIpKTtcblxuICAgICAgLy8gRXh0cmFjdCB0aGUgbWVzc2FnZSBmcm9tIHRoZSBMYW5nZmxvdyByZXNwb25zZSBzdHJ1Y3R1cmVcbiAgICAgIGxldCByYXdNZXNzYWdlO1xuICAgICAgaWYgKGxhbmdmbG93UmVzcG9uc2VEYXRhPy5vdXRwdXRzPy5bMF0/Lm91dHB1dHM/LlswXT8ubWVzc2FnZXM/LlswXT8ubWVzc2FnZSkge1xuICAgICAgICByYXdNZXNzYWdlID0gbGFuZ2Zsb3dSZXNwb25zZURhdGEub3V0cHV0c1swXS5vdXRwdXRzWzBdLm1lc3NhZ2VzWzBdLm1lc3NhZ2U7XG4gICAgICB9XG5cbiAgICAgIGlmICghcmF3TWVzc2FnZSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ291bGQgbm90IGZpbmQgbWVzc2FnZSBpbiByZXNwb25zZS4gRnVsbCByZXNwb25zZTpcIiwgbGFuZ2Zsb3dSZXNwb25zZURhdGEpO1xuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgICAgeyBlcnJvcjogXCJDb3VsZCBub3QgZXh0cmFjdCBtZXNzYWdlIGZyb20gcmVzcG9uc2VcIiB9LFxuICAgICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBQYXJzZSB0aGUgcGlwZS1kZWxpbWl0ZWQgZmllbGRzXG4gICAgICBjb25zdCBbcmF3TGFuZ3VhZ2VzLCBwcm9tcHQsIHJhd0dpdGh1YlVybF0gPSByYXdNZXNzYWdlLnNwbGl0KCd8JykubWFwKChmaWVsZDogc3RyaW5nKSA9PiBmaWVsZC50cmltKCkpO1xuXG4gICAgICAvLyBDbGVhbiBsYW5ndWFnZXMgZnJvbSBMYW5nZmxvdyBkZXRhaWxzXG4gICAgICBjb25zdCBjbGVhbmVkTGFuZ3VhZ2VzID0gY2xlYW5MYW5ndWFnZXNTdHJpbmcocmF3TGFuZ3VhZ2VzKTtcbiAgICAgIGNvbnN0IGNsZWFuZWRHaXRodWJVcmwgPSBjbGVhbkdpdGh1YlVybChyYXdHaXRodWJVcmwsIHVzZXJuYW1lKTtcblxuICAgICAgLy8gLS0tIExvZyBuZXcgZGF0YSAtLS0gXG4gICAgICBjb25zdCBuZXdEYXRhVG9Mb2cgPSB7XG4gICAgICAgIGxhbmd1YWdlczogY2xlYW5lZExhbmd1YWdlcyxcbiAgICAgICAgcHJvbXB0LFxuICAgICAgICBnaXRodWJVcmw6IGNsZWFuZWRHaXRodWJVcmwsXG4gICAgICAgIHJlcG9Db3VudDogMzAsIC8vIEtlZXAgcmVwb0NvdW50IHBsYWNlaG9sZGVyXG4gICAgICAgIGFuaW1hbFNlbGVjdGlvbjogdW5kZWZpbmVkIC8vIEV4cGxpY2l0bHkgdW5kZWZpbmVkIGFzIExhbmdmbG93IGRvZXNuJ3QgcHJvdmlkZSBpdFxuICAgICAgfTtcbiAgICAgIGNvbnNvbGUubG9nKFwiQVBJIFJvdXRlOiBEYXRhIGJlZm9yZSBFdmVyQXJ0IChMYW5nZmxvdyk6XCIsIEpTT04uc3RyaW5naWZ5KG5ld0RhdGFUb0xvZywgbnVsbCwgMikpO1xuICAgICAgLy8gLS0tIEVuZCBMb2cgLS0tXG5cbiAgICAgIC8vIEdlbmVyYXRlIGltYWdlIHVzaW5nIEV2ZXJBcnQgU0RLXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBmdWxsUHJvbXB0ID0gUFJPTVBUX1BSRUZJWCArIHByb21wdDtcbiAgICAgICAgY29uc29sZS5sb2coXCJGdWxsIHByb21wdCBmb3IgbmV3IHVzZXI6XCIsIGZ1bGxQcm9tcHQpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZ2VuZXJhdGlvbnMgPSBhd2FpdCBldmVyYXJ0LnYxLmdlbmVyYXRpb25zLmNyZWF0ZShcbiAgICAgICAgICAnNTAwMCcsIC8vIE1vZGVsIElEIGZvciBGTFVYMS4xXG4gICAgICAgICAgZnVsbFByb21wdCxcbiAgICAgICAgICAndHh0MmltZycsIC8vIEdlbmVyYXRpb24gdHlwZVxuICAgICAgICAgIHsgXG4gICAgICAgICAgICBpbWFnZUNvdW50OiAxLFxuICAgICAgICAgICAgaGVpZ2h0OiA1MTIsXG4gICAgICAgICAgICB3aWR0aDogNTEyXG4gICAgICAgICAgfVxuICAgICAgICApIGFzIEdlbmVyYXRpb25bXTtcblxuICAgICAgICBpZiAoIWdlbmVyYXRpb25zIHx8IGdlbmVyYXRpb25zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gZ2VuZXJhdGlvbnMgcmV0dXJuZWQgZnJvbSBFdmVyQXJ0Jyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBXYWl0IGZvciB0aGUgZmlyc3QgZ2VuZXJhdGlvbiB0byBjb21wbGV0ZVxuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBldmVyYXJ0LnYxLmdlbmVyYXRpb25zLmZldGNoV2l0aFBvbGxpbmcoZ2VuZXJhdGlvbnNbMF0uaWQpIGFzIEdlbmVyYXRpb247XG4gICAgICAgIGNvbnNvbGUubG9nKFwiRXZlckFydCBnZW5lcmF0aW9uIHJlc3VsdCAobmV3IHBhdGgpOlwiLCByZXN1bHQpO1xuXG4gICAgICAgIGNvbnN0IGZpbmFsSW1hZ2VVcmwgPSByZXN1bHQuaW1hZ2VfdXJsIHx8IEZBTExCQUNLX0lNQUdFX1VSTDtcblxuICAgICAgICAvLyAtLS0gU2F2ZS9VcGRhdGUgdGhlIGltYWdlIHJlY29yZCBpbiB0aGUgREIgLS0tIFxuICAgICAgICBpZiAocmVzdWx0LmltYWdlX3VybCkgeyAvLyBPbmx5IHNhdmUgaWYgRXZlckFydCBzdWNjZWVkZWRcbiAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBBUEkgUm91dGU6IFVwc2VydGluZyBpbWFnZSBmb3IgJHtub3JtYWxpemVkVXNlcm5hbWV9IChuZXcgcGF0aClgKTtcbiAgICAgICAgICAgIGF3YWl0IHVwc2VydEltYWdlKHtcbiAgICAgICAgICAgICAgdXNlcm5hbWU6IG5vcm1hbGl6ZWRVc2VybmFtZSxcbiAgICAgICAgICAgICAgaW1hZ2VfdXJsOiBmaW5hbEltYWdlVXJsLFxuICAgICAgICAgICAgICBjcmVhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYEFQSSBSb3V0ZTogVXBzZXJ0IHN1Y2Nlc3NmdWwgZm9yICR7bm9ybWFsaXplZFVzZXJuYW1lfWApO1xuICAgICAgICAgIH0gY2F0Y2ggKGRiRXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEFQSSBSb3V0ZTogRmFpbGVkIHRvIHVwc2VydCBpbWFnZSBmb3IgJHtub3JtYWxpemVkVXNlcm5hbWV9IChuZXcgcGF0aCk6YCwgZGJFcnJvcik7XG4gICAgICAgICAgICAvLyBMb2cgZXJyb3IgYnV0IGNvbnRpbnVlXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIC0tLSBFbmQgU2F2ZS9VcGRhdGUgLS0tXG5cbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgXG4gICAgICAgICAgbGFuZ3VhZ2VzOiBjbGVhbmVkTGFuZ3VhZ2VzLFxuICAgICAgICAgIHByb21wdCxcbiAgICAgICAgICBnaXRodWJVcmw6IGNsZWFuZWRHaXRodWJVcmwsXG4gICAgICAgICAgcmVwb0NvdW50OiBuZXdEYXRhVG9Mb2cucmVwb0NvdW50LFxuICAgICAgICAgIGFuaW1hbFNlbGVjdGlvbjogbmV3RGF0YVRvTG9nLmFuaW1hbFNlbGVjdGlvbiwgLy8gU2VuZCB1bmRlZmluZWRcbiAgICAgICAgICBpbWFnZVVybDogZmluYWxJbWFnZVVybCxcbiAgICAgICAgICB1c2VybmFtZTogbm9ybWFsaXplZFVzZXJuYW1lLCAvLyBFbnN1cmUgbm9ybWFsaXplZCB1c2VybmFtZSBpcyByZXR1cm5lZFxuICAgICAgICAgIHN0YXR1czoge1xuICAgICAgICAgICAgbGFuZ2Zsb3c6IFwic3VjY2Vzc1wiLFxuICAgICAgICAgICAgZXZlcmFydDogcmVzdWx0LmltYWdlX3VybCA/IFwic3VjY2Vzc1wiIDogXCJlcnJvclwiXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGV2ZXJhcnRFcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY2FsbGluZyBFdmVyQXJ0IEFQSTpcIiwgZXZlcmFydEVycm9yKTtcbiAgICAgICAgLy8gQ29udGludWUgd2l0aCBhIHBsYWNlaG9sZGVyIGltYWdlIGlmIEV2ZXJBcnQgZmFpbHNcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgXG4gICAgICAgICAgbGFuZ3VhZ2VzOiBjbGVhbmVkTGFuZ3VhZ2VzLFxuICAgICAgICAgIHByb21wdCxcbiAgICAgICAgICBnaXRodWJVcmw6IGNsZWFuZWRHaXRodWJVcmwsXG4gICAgICAgICAgcmVwb0NvdW50OiBuZXdEYXRhVG9Mb2cucmVwb0NvdW50LFxuICAgICAgICAgIGFuaW1hbFNlbGVjdGlvbjogbmV3RGF0YVRvTG9nLmFuaW1hbFNlbGVjdGlvbiwgLy8gU2VuZCB1bmRlZmluZWRcbiAgICAgICAgICBpbWFnZVVybDogRkFMTEJBQ0tfSU1BR0VfVVJMLFxuICAgICAgICAgIHVzZXJuYW1lOiBub3JtYWxpemVkVXNlcm5hbWUsXG4gICAgICAgICAgc3RhdHVzOiB7XG4gICAgICAgICAgICBsYW5nZmxvdzogXCJzdWNjZXNzXCIsXG4gICAgICAgICAgICBldmVyYXJ0OiBcImVycm9yXCJcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGxhbmdmbG93RXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjYWxsaW5nIExhbmdmbG93IEFQSTpcIiwgbGFuZ2Zsb3dFcnJvcik7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgXG4gICAgICAgICAgZXJyb3I6IFwiRmFpbGVkIHRvIGNvbW11bmljYXRlIHdpdGggTGFuZ2Zsb3cgQVBJXCIsXG4gICAgICAgICAgdXNlcm5hbWU6IG5vcm1hbGl6ZWRVc2VybmFtZSwgLy8gUmV0dXJuIG5vcm1hbGl6ZWQgdXNlcm5hbWVcbiAgICAgICAgICBzdGF0dXM6IHtcbiAgICAgICAgICAgIGxhbmdmbG93OiBcImVycm9yXCIsXG4gICAgICAgICAgICBldmVyYXJ0OiBcIm5vdF9zdGFydGVkXCJcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIGluIEFQSSByb3V0ZTpcIiwgZXJyb3IpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgXG4gICAgICAgIGVycm9yOiBcIkZhaWxlZCB0byBnZW5lcmF0ZSBwcm9tcHRcIixcbiAgICAgICAgc3RhdHVzOiB7XG4gICAgICAgICAgbGFuZ2Zsb3c6IFwiZXJyb3JcIixcbiAgICAgICAgICBldmVyYXJ0OiBcIm5vdF9zdGFydGVkXCJcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICk7XG4gIH1cbn0gIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsIkV2ZXJBcnQiLCJnZXRVc2VyRGV0YWlscyIsInVwc2VydEltYWdlIiwiZXZlcmFydEFwaUtleSIsInByb2Nlc3MiLCJlbnYiLCJFVkVSQVJUX0FQSV9LRVkiLCJFcnJvciIsImV2ZXJhcnQiLCJQUk9NUFRfUFJFRklYIiwiRkFMTEJBQ0tfSU1BR0VfVVJMIiwiY2xlYW5MYW5ndWFnZXNTdHJpbmciLCJyYXdMYW5nU3RyaW5nIiwicmVwbGFjZSIsInRyaW0iLCJjbGVhbkdpdGh1YlVybCIsInJhd1VybCIsInVzZXJuYW1lIiwiZmFsbGJhY2tVcmwiLCJ0b0xvd2VyQ2FzZSIsImNvbnNvbGUiLCJ3YXJuIiwiZ2l0aHViUHJlZml4IiwiaW5kZXgiLCJpbmRleE9mIiwiZXh0cmFjdGVkVXJsIiwic3Vic3RyaW5nIiwibG9nIiwiUE9TVCIsInJlcXVlc3QiLCJib2R5IiwianNvbiIsIm5vcm1hbGl6ZWRVc2VybmFtZSIsImVycm9yIiwic3RhdHVzIiwiZXhpc3RpbmdEZXRhaWxzIiwiY2xlYW5lZExhbmd1YWdlcyIsImxhbmd1YWdlcyIsImNsZWFuZWRHaXRodWJVcmwiLCJnaXRodWJVcmwiLCJkYXRhVG9Mb2ciLCJyZXBvQ291bnQiLCJhbmltYWxTZWxlY3Rpb24iLCJKU09OIiwic3RyaW5naWZ5IiwiZnVsbFByb21wdCIsInByb21wdCIsImdlbmVyYXRpb25zIiwidjEiLCJjcmVhdGUiLCJpbWFnZUNvdW50IiwiaGVpZ2h0Iiwid2lkdGgiLCJsZW5ndGgiLCJyZXN1bHQiLCJmZXRjaFdpdGhQb2xsaW5nIiwiaWQiLCJmaW5hbEltYWdlVXJsIiwiaW1hZ2VfdXJsIiwiY3JlYXRlZF9hdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImRiRXJyb3IiLCJpbWFnZVVybCIsImxhbmdmbG93IiwiZXZlcmFydEVycm9yIiwiTEFOR0ZMT1dfQkFTRV9VUkwiLCJMQU5HRkxPV19GTE9XX0lEIiwibGFuZ2Zsb3dVcmwiLCJyZXNwb25zZSIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsImlucHV0IiwidGV4dCIsIm9rIiwiZXJyb3JUZXh0Iiwic3RhdHVzVGV4dCIsInVybCIsImxhbmdmbG93UmVzcG9uc2VEYXRhIiwicmF3TWVzc2FnZSIsIm91dHB1dHMiLCJtZXNzYWdlcyIsIm1lc3NhZ2UiLCJyYXdMYW5ndWFnZXMiLCJyYXdHaXRodWJVcmwiLCJzcGxpdCIsIm1hcCIsImZpZWxkIiwibmV3RGF0YVRvTG9nIiwidW5kZWZpbmVkIiwibGFuZ2Zsb3dFcnJvciJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/generate/prompt/route.ts\n");

/***/ }),

/***/ "(rsc)/./app/lib/db/astra.ts":
/*!*****************************!*\
  !*** ./app/lib/db/astra.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getAllImages: () => (/* binding */ getAllImages),\n/* harmony export */   getAstraClient: () => (/* binding */ getAstraClient),\n/* harmony export */   getImageByUsername: () => (/* binding */ getImageByUsername),\n/* harmony export */   getUserDetails: () => (/* binding */ getUserDetails),\n/* harmony export */   upsertImage: () => (/* binding */ upsertImage)\n/* harmony export */ });\n/* harmony import */ var _datastax_astra_db_ts__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @datastax/astra-db-ts */ \"(rsc)/./node_modules/@datastax/astra-db-ts/dist/index.js\");\n/* harmony import */ var _datastax_astra_db_ts__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_datastax_astra_db_ts__WEBPACK_IMPORTED_MODULE_0__);\n\n// Database client singleton\nlet astraClient = null;\nasync function getAstraClient() {\n    if (astraClient === null) {\n        const endpoint = process.env.ASTRA_DB_ENDPOINT;\n        const token = process.env.ASTRA_DB_APPLICATION_TOKEN;\n        if (!endpoint || !token) {\n            throw new Error(\"Missing required Astra DB configuration\");\n        }\n        try {\n            console.log(\"Connecting to Astra DB with endpoint:\", endpoint);\n            const client = new _datastax_astra_db_ts__WEBPACK_IMPORTED_MODULE_0__.DataAPIClient(token);\n            astraClient = client.db(endpoint);\n            console.log(\"Successfully connected to Astra DB\");\n        } catch (error) {\n            console.error(\"Failed to connect to Astra DB:\", error);\n            throw error;\n        }\n    }\n    return astraClient;\n}\n// Collection getters\nasync function getImagesCollection() {\n    const client = await getAstraClient();\n    return client.collection(\"images\");\n}\nasync function getUserDetailsCollection() {\n    const client = await getAstraClient();\n    return client.collection(\"github_user_details\");\n}\n// Image operations\nasync function getAllImages() {\n    try {\n        console.log(\"getAllImages - Fetching images collection\");\n        const collection = await getImagesCollection();\n        console.log(\"getAllImages - Finding all records\");\n        const records = await collection.find().toArray();\n        console.log(`getAllImages - Found ${records.length} records`);\n        return records;\n    } catch (error) {\n        console.error(\"getAllImages - Error:\", error);\n        throw error;\n    }\n}\nasync function getImageByUsername(username) {\n    try {\n        const normalizedUsername = username.toLowerCase();\n        console.log(`getImageByUsername - Finding image for ${normalizedUsername}`);\n        const collection = await getImagesCollection();\n        const records = await collection.find({\n            username: normalizedUsername\n        }).toArray();\n        console.log(`getImageByUsername - Found ${records.length} records`);\n        if (!records.length) {\n            return null;\n        }\n        // Return the most recent image if multiple exist\n        return records[0];\n    } catch (error) {\n        console.error(\"getImageByUsername - Error:\", error);\n        throw error;\n    }\n}\nasync function upsertImage(imageData) {\n    try {\n        const normalizedUsername = imageData.username.toLowerCase();\n        console.log(`upsertImage - Processing image for ${normalizedUsername}`);\n        const collection = await getImagesCollection();\n        // Find existing record\n        const existingRecord = await collection.findOne({\n            username: normalizedUsername\n        });\n        const imageRecord = {\n            ...imageData,\n            username: normalizedUsername\n        };\n        let result;\n        if (existingRecord) {\n            // Update existing record\n            console.log(`upsertImage - Updating existing record: ${existingRecord._id}`);\n            result = await collection.updateOne({\n                _id: existingRecord._id\n            }, {\n                $set: imageRecord\n            });\n        } else {\n            // Insert new record\n            console.log(\"upsertImage - Creating new record\");\n            result = await collection.insertOne(imageRecord);\n        }\n        console.log(\"upsertImage - Operation result:\", result);\n        return result;\n    } catch (error) {\n        console.error(\"upsertImage - Error:\", error);\n        throw error;\n    }\n}\n// User details operations - Reverted to parse body_blob\nasync function getUserDetails(username) {\n    console.log(`DB Service: Fetching user details for username: ${username}`);\n    const normalizedUsername = username.toLowerCase();\n    try {\n        const userDetailsCollection = await getUserDetailsCollection();\n        // Find the document based on session_id, only fetch necessary fields\n        const record = await userDetailsCollection.findOne({\n            session_id: normalizedUsername\n        }, {\n            projection: {\n                _id: 1,\n                session_id: 1,\n                body_blob: 1\n            }\n        } // Fetch blob and ids\n        );\n        console.log(`DB Service: Found record (using session_id):`, record);\n        if (record?.body_blob) {\n            try {\n                const bodyBlob = JSON.parse(record.body_blob);\n                console.log(`DB Service: Parsed body_blob:`, bodyBlob);\n                // Assuming structure is { type: 'ai', data: { content: 'lang|prompt|url' } } \n                // AND potentially other fields like repoCount, animalSelection under data\n                if (bodyBlob.type === 'ai' && bodyBlob.data?.content) {\n                    const content = bodyBlob.data.content;\n                    const [languages, prompt, githubUrl] = content.split('|').map((field)=>field.trim());\n                    // Extract potential extra fields from bodyBlob.data\n                    const repoCount = bodyBlob.data.repoCount;\n                    const animalSelection = bodyBlob.data.animalSelection;\n                    const userDetails = {\n                        _id: record._id,\n                        session_id: record.session_id,\n                        username: record.session_id,\n                        languages,\n                        prompt,\n                        githubUrl,\n                        repoCount,\n                        animalSelection\n                    };\n                    console.log(`DB Service: Parsed user details from blob:`, userDetails);\n                    return userDetails;\n                } else {\n                    console.warn(`DB Service: body_blob found but content format unexpected for ${normalizedUsername}`);\n                }\n            } catch (parseError) {\n                console.error(`DB Service: Error parsing body_blob for ${normalizedUsername}:`, parseError);\n            }\n        }\n        console.log(`DB Service: No valid user details found or parsed for ${normalizedUsername}`);\n        return null;\n    } catch (error) {\n        console.error(\"DB Service: Error fetching user details:\", error);\n        return null;\n    }\n}\n// Export the client getter for advanced use cases\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LFFBQVFJLEtBQUssQ0FBQyxLQUFLQyxHQUFHLENBQUMsQ0FBQ0MsUUFBa0JBLE1BQU1DLElBQUk7b0JBRTNGLG9EQUFvRDtvQkFDcEQsTUFBTUMsWUFBWWIsU0FBU0ksSUFBSSxDQUFDUyxTQUFTO29CQUN6QyxNQUFNQyxrQkFBa0JkLFNBQVNJLElBQUksQ0FBQ1UsZUFBZTtvQkFFckQsTUFBTUMsY0FBaUM7d0JBQ3JDekIsS0FBS00sT0FBT04sR0FBRzt3QkFDZk8sWUFBWUQsT0FBT0MsVUFBVTt3QkFDN0JoQixVQUFVZSxPQUFPQyxVQUFVO3dCQUMzQlM7d0JBQ0FDO3dCQUNBQzt3QkFDQUs7d0JBQ0FDO29CQUNGO29CQUNBL0MsUUFBUUMsR0FBRyxDQUFDLENBQUMsMENBQTBDLENBQUMsRUFBRStDO29CQUMxRCxPQUFPQTtnQkFDVCxPQUFPO29CQUNMaEQsUUFBUWlELElBQUksQ0FBQyxDQUFDLDhEQUE4RCxFQUFFbEMsb0JBQW9CO2dCQUNwRztZQUNGLEVBQUUsT0FBT21DLFlBQVk7Z0JBQ25CbEQsUUFBUUksS0FBSyxDQUFDLENBQUMsd0NBQXdDLEVBQUVXLG1CQUFtQixDQUFDLENBQUMsRUFBRW1DO1lBQ2xGO1FBQ0Y7UUFFQWxELFFBQVFDLEdBQUcsQ0FBQyxDQUFDLHNEQUFzRCxFQUFFYyxvQkFBb0I7UUFDekYsT0FBTztJQUNULEVBQUUsT0FBT1gsT0FBTztRQUNkSixRQUFRSSxLQUFLLENBQUMsNENBQTRDQTtRQUMxRCxPQUFPO0lBQ1Q7QUFDRjtBQUVBLGtEQUFrRDtBQUN4QiIsInNvdXJjZXMiOlsiL1VzZXJzL2RhdmlkLmdpbGFyZGkvY29kZWJlYXN0cy9hcHAvbGliL2RiL2FzdHJhLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERhdGFBUElDbGllbnQgfSBmcm9tIFwiQGRhdGFzdGF4L2FzdHJhLWRiLXRzXCI7XG5cbi8vIFR5cGVzXG5leHBvcnQgdHlwZSBJbWFnZVJlY29yZCA9IHtcbiAgX2lkPzogc3RyaW5nO1xuICB1c2VybmFtZTogc3RyaW5nO1xuICBpbWFnZV91cmw6IHN0cmluZztcbiAgY3JlYXRlZF9hdDogc3RyaW5nO1xufTtcblxuZXhwb3J0IHR5cGUgVXNlckRldGFpbHNSZWNvcmQgPSB7XG4gIF9pZD86IHN0cmluZztcbiAgc2Vzc2lvbl9pZDogc3RyaW5nO1xuICB1c2VybmFtZTogc3RyaW5nO1xuICBsYW5ndWFnZXM6IHN0cmluZztcbiAgcHJvbXB0OiBzdHJpbmc7XG4gIGdpdGh1YlVybDogc3RyaW5nO1xuICByZXBvQ291bnQ/OiBudW1iZXI7XG4gIGFuaW1hbFNlbGVjdGlvbj86IGFueVtdW107XG59O1xuXG4vLyBEYXRhYmFzZSBjbGllbnQgc2luZ2xldG9uXG5sZXQgYXN0cmFDbGllbnQ6IGFueSA9IG51bGw7XG5cbmFzeW5jIGZ1bmN0aW9uIGdldEFzdHJhQ2xpZW50KCkge1xuICBpZiAoYXN0cmFDbGllbnQgPT09IG51bGwpIHtcbiAgICBjb25zdCBlbmRwb2ludCA9IHByb2Nlc3MuZW52LkFTVFJBX0RCX0VORFBPSU5UO1xuICAgIGNvbnN0IHRva2VuID0gcHJvY2Vzcy5lbnYuQVNUUkFfREJfQVBQTElDQVRJT05fVE9LRU47XG5cbiAgICBpZiAoIWVuZHBvaW50IHx8ICF0b2tlbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTWlzc2luZyByZXF1aXJlZCBBc3RyYSBEQiBjb25maWd1cmF0aW9uXCIpO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZyhcIkNvbm5lY3RpbmcgdG8gQXN0cmEgREIgd2l0aCBlbmRwb2ludDpcIiwgZW5kcG9pbnQpO1xuICAgICAgY29uc3QgY2xpZW50ID0gbmV3IERhdGFBUElDbGllbnQodG9rZW4pO1xuICAgICAgYXN0cmFDbGllbnQgPSBjbGllbnQuZGIoZW5kcG9pbnQpO1xuICAgICAgY29uc29sZS5sb2coXCJTdWNjZXNzZnVsbHkgY29ubmVjdGVkIHRvIEFzdHJhIERCXCIpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGNvbm5lY3QgdG8gQXN0cmEgREI6XCIsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuICByZXR1cm4gYXN0cmFDbGllbnQ7XG59XG5cbi8vIENvbGxlY3Rpb24gZ2V0dGVyc1xuYXN5bmMgZnVuY3Rpb24gZ2V0SW1hZ2VzQ29sbGVjdGlvbigpIHtcbiAgY29uc3QgY2xpZW50ID0gYXdhaXQgZ2V0QXN0cmFDbGllbnQoKTtcbiAgcmV0dXJuIGNsaWVudC5jb2xsZWN0aW9uKFwiaW1hZ2VzXCIpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRVc2VyRGV0YWlsc0NvbGxlY3Rpb24oKSB7XG4gIGNvbnN0IGNsaWVudCA9IGF3YWl0IGdldEFzdHJhQ2xpZW50KCk7XG4gIHJldHVybiBjbGllbnQuY29sbGVjdGlvbihcImdpdGh1Yl91c2VyX2RldGFpbHNcIik7XG59XG5cbi8vIEltYWdlIG9wZXJhdGlvbnNcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbGxJbWFnZXMoKSB7XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coXCJnZXRBbGxJbWFnZXMgLSBGZXRjaGluZyBpbWFnZXMgY29sbGVjdGlvblwiKTtcbiAgICBjb25zdCBjb2xsZWN0aW9uID0gYXdhaXQgZ2V0SW1hZ2VzQ29sbGVjdGlvbigpO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKFwiZ2V0QWxsSW1hZ2VzIC0gRmluZGluZyBhbGwgcmVjb3Jkc1wiKTtcbiAgICBjb25zdCByZWNvcmRzID0gYXdhaXQgY29sbGVjdGlvbi5maW5kKCkudG9BcnJheSgpO1xuICAgIGNvbnNvbGUubG9nKGBnZXRBbGxJbWFnZXMgLSBGb3VuZCAke3JlY29yZHMubGVuZ3RofSByZWNvcmRzYCk7XG4gICAgXG4gICAgcmV0dXJuIHJlY29yZHM7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcImdldEFsbEltYWdlcyAtIEVycm9yOlwiLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEltYWdlQnlVc2VybmFtZSh1c2VybmFtZTogc3RyaW5nKSB7XG4gIHRyeSB7XG4gICAgY29uc3Qgbm9ybWFsaXplZFVzZXJuYW1lID0gdXNlcm5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICBjb25zb2xlLmxvZyhgZ2V0SW1hZ2VCeVVzZXJuYW1lIC0gRmluZGluZyBpbWFnZSBmb3IgJHtub3JtYWxpemVkVXNlcm5hbWV9YCk7XG4gICAgXG4gICAgY29uc3QgY29sbGVjdGlvbiA9IGF3YWl0IGdldEltYWdlc0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCByZWNvcmRzID0gYXdhaXQgY29sbGVjdGlvbi5maW5kKHsgdXNlcm5hbWU6IG5vcm1hbGl6ZWRVc2VybmFtZSB9KS50b0FycmF5KCk7XG4gICAgY29uc29sZS5sb2coYGdldEltYWdlQnlVc2VybmFtZSAtIEZvdW5kICR7cmVjb3Jkcy5sZW5ndGh9IHJlY29yZHNgKTtcblxuICAgIGlmICghcmVjb3Jkcy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIC8vIFJldHVybiB0aGUgbW9zdCByZWNlbnQgaW1hZ2UgaWYgbXVsdGlwbGUgZXhpc3RcbiAgICByZXR1cm4gcmVjb3Jkc1swXTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiZ2V0SW1hZ2VCeVVzZXJuYW1lIC0gRXJyb3I6XCIsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBzZXJ0SW1hZ2UoaW1hZ2VEYXRhOiBPbWl0PEltYWdlUmVjb3JkLCAnX2lkJz4pIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBub3JtYWxpemVkVXNlcm5hbWUgPSBpbWFnZURhdGEudXNlcm5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICBjb25zb2xlLmxvZyhgdXBzZXJ0SW1hZ2UgLSBQcm9jZXNzaW5nIGltYWdlIGZvciAke25vcm1hbGl6ZWRVc2VybmFtZX1gKTtcblxuICAgIGNvbnN0IGNvbGxlY3Rpb24gPSBhd2FpdCBnZXRJbWFnZXNDb2xsZWN0aW9uKCk7XG4gICAgXG4gICAgLy8gRmluZCBleGlzdGluZyByZWNvcmRcbiAgICBjb25zdCBleGlzdGluZ1JlY29yZCA9IGF3YWl0IGNvbGxlY3Rpb24uZmluZE9uZSh7IHVzZXJuYW1lOiBub3JtYWxpemVkVXNlcm5hbWUgfSk7XG4gICAgXG4gICAgY29uc3QgaW1hZ2VSZWNvcmQgPSB7XG4gICAgICAuLi5pbWFnZURhdGEsXG4gICAgICB1c2VybmFtZTogbm9ybWFsaXplZFVzZXJuYW1lXG4gICAgfTtcblxuICAgIGxldCByZXN1bHQ7XG4gICAgaWYgKGV4aXN0aW5nUmVjb3JkKSB7XG4gICAgICAvLyBVcGRhdGUgZXhpc3RpbmcgcmVjb3JkXG4gICAgICBjb25zb2xlLmxvZyhgdXBzZXJ0SW1hZ2UgLSBVcGRhdGluZyBleGlzdGluZyByZWNvcmQ6ICR7ZXhpc3RpbmdSZWNvcmQuX2lkfWApO1xuICAgICAgcmVzdWx0ID0gYXdhaXQgY29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgIHsgX2lkOiBleGlzdGluZ1JlY29yZC5faWQgfSxcbiAgICAgICAgeyAkc2V0OiBpbWFnZVJlY29yZCB9XG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBJbnNlcnQgbmV3IHJlY29yZFxuICAgICAgY29uc29sZS5sb2coXCJ1cHNlcnRJbWFnZSAtIENyZWF0aW5nIG5ldyByZWNvcmRcIik7XG4gICAgICByZXN1bHQgPSBhd2FpdCBjb2xsZWN0aW9uLmluc2VydE9uZShpbWFnZVJlY29yZCk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coXCJ1cHNlcnRJbWFnZSAtIE9wZXJhdGlvbiByZXN1bHQ6XCIsIHJlc3VsdCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwidXBzZXJ0SW1hZ2UgLSBFcnJvcjpcIiwgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8vIFVzZXIgZGV0YWlscyBvcGVyYXRpb25zIC0gUmV2ZXJ0ZWQgdG8gcGFyc2UgYm9keV9ibG9iXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VXNlckRldGFpbHModXNlcm5hbWU6IHN0cmluZyk6IFByb21pc2U8VXNlckRldGFpbHNSZWNvcmQgfCBudWxsPiB7XG4gIGNvbnNvbGUubG9nKGBEQiBTZXJ2aWNlOiBGZXRjaGluZyB1c2VyIGRldGFpbHMgZm9yIHVzZXJuYW1lOiAke3VzZXJuYW1lfWApO1xuICBjb25zdCBub3JtYWxpemVkVXNlcm5hbWUgPSB1c2VybmFtZS50b0xvd2VyQ2FzZSgpO1xuICB0cnkge1xuICAgIGNvbnN0IHVzZXJEZXRhaWxzQ29sbGVjdGlvbiA9IGF3YWl0IGdldFVzZXJEZXRhaWxzQ29sbGVjdGlvbigpO1xuICAgIFxuICAgIC8vIEZpbmQgdGhlIGRvY3VtZW50IGJhc2VkIG9uIHNlc3Npb25faWQsIG9ubHkgZmV0Y2ggbmVjZXNzYXJ5IGZpZWxkc1xuICAgIGNvbnN0IHJlY29yZCA9IGF3YWl0IHVzZXJEZXRhaWxzQ29sbGVjdGlvbi5maW5kT25lKFxuICAgICAgeyBzZXNzaW9uX2lkOiBub3JtYWxpemVkVXNlcm5hbWUgfSwgXG4gICAgICB7IHByb2plY3Rpb246IHsgX2lkOiAxLCBzZXNzaW9uX2lkOiAxLCBib2R5X2Jsb2I6IDEgfSB9IC8vIEZldGNoIGJsb2IgYW5kIGlkc1xuICAgICk7XG5cbiAgICBjb25zb2xlLmxvZyhgREIgU2VydmljZTogRm91bmQgcmVjb3JkICh1c2luZyBzZXNzaW9uX2lkKTpgLCByZWNvcmQpO1xuXG4gICAgaWYgKHJlY29yZD8uYm9keV9ibG9iKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBib2R5QmxvYiA9IEpTT04ucGFyc2UocmVjb3JkLmJvZHlfYmxvYik7XG4gICAgICAgIGNvbnNvbGUubG9nKGBEQiBTZXJ2aWNlOiBQYXJzZWQgYm9keV9ibG9iOmAsIGJvZHlCbG9iKTtcblxuICAgICAgICAvLyBBc3N1bWluZyBzdHJ1Y3R1cmUgaXMgeyB0eXBlOiAnYWknLCBkYXRhOiB7IGNvbnRlbnQ6ICdsYW5nfHByb21wdHx1cmwnIH0gfSBcbiAgICAgICAgLy8gQU5EIHBvdGVudGlhbGx5IG90aGVyIGZpZWxkcyBsaWtlIHJlcG9Db3VudCwgYW5pbWFsU2VsZWN0aW9uIHVuZGVyIGRhdGFcbiAgICAgICAgaWYgKGJvZHlCbG9iLnR5cGUgPT09ICdhaScgJiYgYm9keUJsb2IuZGF0YT8uY29udGVudCkge1xuICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBib2R5QmxvYi5kYXRhLmNvbnRlbnQ7XG4gICAgICAgICAgY29uc3QgW2xhbmd1YWdlcywgcHJvbXB0LCBnaXRodWJVcmxdID0gY29udGVudC5zcGxpdCgnfCcpLm1hcCgoZmllbGQ6IHN0cmluZykgPT4gZmllbGQudHJpbSgpKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBFeHRyYWN0IHBvdGVudGlhbCBleHRyYSBmaWVsZHMgZnJvbSBib2R5QmxvYi5kYXRhXG4gICAgICAgICAgY29uc3QgcmVwb0NvdW50ID0gYm9keUJsb2IuZGF0YS5yZXBvQ291bnQ7IFxuICAgICAgICAgIGNvbnN0IGFuaW1hbFNlbGVjdGlvbiA9IGJvZHlCbG9iLmRhdGEuYW5pbWFsU2VsZWN0aW9uO1xuXG4gICAgICAgICAgY29uc3QgdXNlckRldGFpbHM6IFVzZXJEZXRhaWxzUmVjb3JkID0ge1xuICAgICAgICAgICAgX2lkOiByZWNvcmQuX2lkLFxuICAgICAgICAgICAgc2Vzc2lvbl9pZDogcmVjb3JkLnNlc3Npb25faWQsXG4gICAgICAgICAgICB1c2VybmFtZTogcmVjb3JkLnNlc3Npb25faWQsIC8vIFVzZSBzZXNzaW9uX2lkIGFzIHRoZSB1c2VybmFtZSBmaWVsZCBmb3IgcmV0dXJuIGNvbnNpc3RlbmN5XG4gICAgICAgICAgICBsYW5ndWFnZXMsXG4gICAgICAgICAgICBwcm9tcHQsXG4gICAgICAgICAgICBnaXRodWJVcmwsXG4gICAgICAgICAgICByZXBvQ291bnQsIC8vIFdpbGwgYmUgdW5kZWZpbmVkIGlmIG5vdCBwcmVzZW50IGluIGJsb2JcbiAgICAgICAgICAgIGFuaW1hbFNlbGVjdGlvbiwgLy8gV2lsbCBiZSB1bmRlZmluZWQgaWYgbm90IHByZXNlbnQgaW4gYmxvYlxuICAgICAgICAgIH07XG4gICAgICAgICAgY29uc29sZS5sb2coYERCIFNlcnZpY2U6IFBhcnNlZCB1c2VyIGRldGFpbHMgZnJvbSBibG9iOmAsIHVzZXJEZXRhaWxzKTtcbiAgICAgICAgICByZXR1cm4gdXNlckRldGFpbHM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKGBEQiBTZXJ2aWNlOiBib2R5X2Jsb2IgZm91bmQgYnV0IGNvbnRlbnQgZm9ybWF0IHVuZXhwZWN0ZWQgZm9yICR7bm9ybWFsaXplZFVzZXJuYW1lfWApO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChwYXJzZUVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYERCIFNlcnZpY2U6IEVycm9yIHBhcnNpbmcgYm9keV9ibG9iIGZvciAke25vcm1hbGl6ZWRVc2VybmFtZX06YCwgcGFyc2VFcnJvcik7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIGNvbnNvbGUubG9nKGBEQiBTZXJ2aWNlOiBObyB2YWxpZCB1c2VyIGRldGFpbHMgZm91bmQgb3IgcGFyc2VkIGZvciAke25vcm1hbGl6ZWRVc2VybmFtZX1gKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiREIgU2VydmljZTogRXJyb3IgZmV0Y2hpbmcgdXNlciBkZXRhaWxzOlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLy8gRXhwb3J0IHRoZSBjbGllbnQgZ2V0dGVyIGZvciBhZHZhbmNlZCB1c2UgY2FzZXNcbmV4cG9ydCB7IGdldEFzdHJhQ2xpZW50IH07ICJdLCJuYW1lcyI6WyJEYXRhQVBJQ2xpZW50IiwiYXN0cmFDbGllbnQiLCJnZXRBc3RyYUNsaWVudCIsImVuZHBvaW50IiwicHJvY2VzcyIsImVudiIsIkFTVFJBX0RCX0VORFBPSU5UIiwidG9rZW4iLCJBU1RSQV9EQl9BUFBMSUNBVElPTl9UT0tFTiIsIkVycm9yIiwiY29uc29sZSIsImxvZyIsImNsaWVudCIsImRiIiwiZXJyb3IiLCJnZXRJbWFnZXNDb2xsZWN0aW9uIiwiY29sbGVjdGlvbiIsImdldFVzZXJEZXRhaWxzQ29sbGVjdGlvbiIsImdldEFsbEltYWdlcyIsInJlY29yZHMiLCJmaW5kIiwidG9BcnJheSIsImxlbmd0aCIsImdldEltYWdlQnlVc2VybmFtZSIsInVzZXJuYW1lIiwibm9ybWFsaXplZFVzZXJuYW1lIiwidG9Mb3dlckNhc2UiLCJ1cHNlcnRJbWFnZSIsImltYWdlRGF0YSIsImV4aXN0aW5nUmVjb3JkIiwiZmluZE9uZSIsImltYWdlUmVjb3JkIiwicmVzdWx0IiwiX2lkIiwidXBkYXRlT25lIiwiJHNldCIsImluc2VydE9uZSIsImdldFVzZXJEZXRhaWxzIiwidXNlckRldGFpbHNDb2xsZWN0aW9uIiwicmVjb3JkIiwic2Vzc2lvbl9pZCIsInByb2plY3Rpb24iLCJib2R5X2Jsb2IiLCJib2R5QmxvYiIsIkpTT04iLCJwYXJzZSIsInR5cGUiLCJkYXRhIiwiY29udGVudCIsImxhbmd1YWdlcyIsInByb21wdCIsImdpdGh1YlVybCIsInNwbGl0IiwibWFwIiwiZmllbGQiLCJ0cmltIiwicmVwb0NvdW50IiwiYW5pbWFsU2VsZWN0aW9uIiwidXNlckRldGFpbHMiLCJ3YXJuIiwicGFyc2VFcnJvciJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/lib/db/astra.ts\n");

/***/ }),

/***/ "(rsc)/./node_modules/@datastax/astra-db-ts/dist/api/fetch sync recursive":
/*!*****************************************************************!*\
  !*** ./node_modules/@datastax/astra-db-ts/dist/api/fetch/ sync ***!
  \*****************************************************************/
/***/ ((module) => {

function webpackEmptyContext(req) {
	var e = new Error("Cannot find module '" + req + "'");
	e.code = 'MODULE_NOT_FOUND';
	throw e;
}
webpackEmptyContext.keys = () => ([]);
webpackEmptyContext.resolve = webpackEmptyContext;
webpackEmptyContext.id = "(rsc)/./node_modules/@datastax/astra-db-ts/dist/api/fetch sync recursive";
module.exports = webpackEmptyContext;

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fgenerate%2Fprompt%2Froute&page=%2Fapi%2Fgenerate%2Fprompt%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate%2Fprompt%2Froute.ts&appDir=%2FUsers%2Fdavid.gilardi%2Fcodebeasts%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fdavid.gilardi%2Fcodebeasts&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fgenerate%2Fprompt%2Froute&page=%2Fapi%2Fgenerate%2Fprompt%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate%2Fprompt%2Froute.ts&appDir=%2FUsers%2Fdavid.gilardi%2Fcodebeasts%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fdavid.gilardi%2Fcodebeasts&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_david_gilardi_codebeasts_app_api_generate_prompt_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/generate/prompt/route.ts */ \"(rsc)/./app/api/generate/prompt/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/generate/prompt/route\",\n        pathname: \"/api/generate/prompt\",\n        filename: \"route\",\n        bundlePath: \"app/api/generate/prompt/route\"\n    },\n    resolvedPagePath: \"/Users/david.gilardi/codebeasts/app/api/generate/prompt/route.ts\",\n    nextConfigOutput,\n    userland: _Users_david_gilardi_codebeasts_app_api_generate_prompt_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZnZW5lcmF0ZSUyRnByb21wdCUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGZ2VuZXJhdGUlMkZwcm9tcHQlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZnZW5lcmF0ZSUyRnByb21wdCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmRhdmlkLmdpbGFyZGklMkZjb2RlYmVhc3RzJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRmRhdmlkLmdpbGFyZGklMkZjb2RlYmVhc3RzJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUErRjtBQUN2QztBQUNxQjtBQUNnQjtBQUM3RjtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IseUdBQW1CO0FBQzNDO0FBQ0EsY0FBYyxrRUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLHNEQUFzRDtBQUM5RDtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUMwRjs7QUFFMUYiLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL2RhdmlkLmdpbGFyZGkvY29kZWJlYXN0cy9hcHAvYXBpL2dlbmVyYXRlL3Byb21wdC9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvZ2VuZXJhdGUvcHJvbXB0L3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvZ2VuZXJhdGUvcHJvbXB0XCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9nZW5lcmF0ZS9wcm9tcHQvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvZGF2aWQuZ2lsYXJkaS9jb2RlYmVhc3RzL2FwcC9hcGkvZ2VuZXJhdGUvcHJvbXB0L3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgd29ya0FzeW5jU3RvcmFnZSxcbiAgICAgICAgd29ya1VuaXRBc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fgenerate%2Fprompt%2Froute&page=%2Fapi%2Fgenerate%2Fprompt%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate%2Fprompt%2Froute.ts&appDir=%2FUsers%2Fdavid.gilardi%2Fcodebeasts%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fdavid.gilardi%2Fcodebeasts&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("assert");

/***/ }),

/***/ "constants":
/*!****************************!*\
  !*** external "constants" ***!
  \****************************/
/***/ ((module) => {

"use strict";
module.exports = require("constants");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "tty":
/*!**********************!*\
  !*** external "tty" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tty");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@datastax","vendor-chunks/safe-stable-stringify","vendor-chunks/uuidv7","vendor-chunks/fs-extra","vendor-chunks/uuid","vendor-chunks/asynckit","vendor-chunks/math-intrinsics","vendor-chunks/es-errors","vendor-chunks/everart","vendor-chunks/call-bind-apply-helpers","vendor-chunks/graceful-fs","vendor-chunks/debug","vendor-chunks/get-proto","vendor-chunks/mime-db","vendor-chunks/jsonfile","vendor-chunks/has-symbols","vendor-chunks/gopd","vendor-chunks/function-bind","vendor-chunks/form-data","vendor-chunks/follow-redirects","vendor-chunks/axios","vendor-chunks/universalify","vendor-chunks/supports-color","vendor-chunks/proxy-from-env","vendor-chunks/ms","vendor-chunks/mime-types","vendor-chunks/hasown","vendor-chunks/has-tostringtag","vendor-chunks/has-flag","vendor-chunks/get-intrinsic","vendor-chunks/es-set-tostringtag","vendor-chunks/es-object-atoms","vendor-chunks/es-define-property","vendor-chunks/dunder-proto","vendor-chunks/delayed-stream","vendor-chunks/combined-stream"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fgenerate%2Fprompt%2Froute&page=%2Fapi%2Fgenerate%2Fprompt%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fgenerate%2Fprompt%2Froute.ts&appDir=%2FUsers%2Fdavid.gilardi%2Fcodebeasts%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fdavid.gilardi%2Fcodebeasts&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();